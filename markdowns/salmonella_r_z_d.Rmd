---
title: "r v z v d"
author: "Jessica Bonnie"
date: "11/2/2022"
output: html_document
---

```{r prep, echo=FALSE,warning=FALSE,include=FALSE}

require(tidyr)
require(ggplot2)
require(data.table)
require(openssl)
require(dplyr)
require(optparse)
require(callr)
codelib<-'/home/jbonnie1/dandd/dev-dandD/lib'
source(file.path(codelib,'plot_progressive.R'))

```

```{bash, eval=FALSE}
tag=salmonellarz
wkdir=/scratch4/blangme2/jessica/dandd/RECOMB/r_z_delta/
#/scratch4/blangme2/oahmed/r_and_z_results/data/global_path_filelist.txt
filelist=/scratch4/blangme2/jessica/dandd/RECOMB/r_z_delta/global_path_filelist.txt
codelib=/home/jbonnie1/dandd/dev-dandD/lib

#python lib/dandd_cmd.py tree -s ${tag} --no-canon -f ${filelist} -o $wkdir
python ${codelib}/dandd_cmd.py tree -s ${tag} -f ${filelist} -o $wkdir --exact

tag=salmonellarz_nocanon
python ${codelib}/dandd_cmd.py tree -s ${tag} -f ${filelist} -o $wkdir --exact --nocanon



```


```{bash, eval=FALSE}
tagtop=salmonellarz_concat
wkdir=/scratch4/blangme2/jessica/dandd/RECOMB/r_z_delta/
  timedir=${wkdir}/time
  mkdir ${timedir}
  #/scratch4/blangme2/oahmed/r_and_z_results/data/global_path_filelist.txt
  summary=${wkdir}/${tagtop}_bench.csv
  echo "ngen,MaxResSetSize_kb, WallClock_hms,SystemTime_sec,UserTime_sec, canon" > ${summary}
for i in $(seq 1 50); do
  fastaname=/scratch4/blangme2/oahmed/r_and_z_results/exp1_final_ref_files/ref_with_${i}_genomes_forward_only.fna
  tag=${tagtop}${i}
  cmd="echo "$fastaname" | python /home/jbonnie1/dandd/dev-dandD/lib/dandd_cmd.py tree -s "${tag}" --exact -k 14 -f /dev/stdin -e 1 -o "${wkdir}
  /usr/bin/time -o ${timedir}/${tag}.out -v sh -c "${cmd}"
  mrss=$(grep "Maximum resident" ${timedir}/${tag}.out | awk '{print $NF}')
  wctime=$(grep "wall clock" ${timedir}/${tag}.out | awk '{print $NF}')
  systime=$(grep "System time" ${timedir}/${tag}.out | awk '{print $NF}')
  utime=$(grep "User time" ${timedir}/${tag}.out | awk '{print $NF}')
  echo "${i},${mrss},${wctime},${systime},${utime},1" >> ${summary}
  done
  
mkdir ${wkdir}/${tagtop}
mv ${wkdir}/${tagtop}*_* ${wkdir}/${tagtop}/.

filelist=/scratch4/blangme2/jessica/dandd/RECOMB/r_z_delta/global_path_filelist.txt

codelib=/home/jbonnie1/dandd/dev-dandD/lib

#python lib/dandd_cmd.py tree -s ${tag} --no-canon -f ${filelist} -o $wkdir
python ${codelib}/dandd_cmd.py tree -s ${tag} -f ${filelist} -o $wkdir --exact

tag=salmonellarz_nocanon
python ${codelib}/dandd_cmd.py tree -s ${tag} -f ${filelist} -o $wkdir --exact --nocanon



```



```{bash partest}
tagtop=salmonellarz_concat_nc
wkdir=/scratch4/blangme2/jessica/dandd/RECOMB/r_z_delta/
cd ${wkdir}
  timedir=${wkdir}/time
  mkdir ${timedir}
  #/scratch4/blangme2/oahmed/r_and_z_results/data/global_path_filelist.txt
  summary=${wkdir}/${tagtop}_bench.csv
  echo "ngen,MaxResSetSize_kb, WallClock_hms,SystemTime_sec,UserTime_sec, canon" > ${summary}
for i in $(seq 1 50); do
  fastaname=/scratch4/blangme2/oahmed/r_and_z_results/exp1_final_ref_files/ref_with_${i}_genomes_forward_only.fna
  tag=${tagtop}${i}
  cmd="echo "$fastaname" | python /home/jbonnie1/dandd/dev-dandD/lib/dandd_cmd.py tree -s "${tag}" --no-canon --exact -k 14 -f /dev/stdin -e 1 -o "${wkdir}
  /usr/bin/time -o ${timedir}/${tag}.out -v sh -c "${cmd}"
  mrss=$(grep "Maximum resident" ${timedir}/${tag}.out | awk '{print $NF}')
  wctime=$(grep "wall clock" ${timedir}/${tag}.out | awk '{print $NF}')
  systime=$(grep "System time" ${timedir}/${tag}.out | awk '{print $NF}')
  utime=$(grep "User time" ${timedir}/${tag}.out | awk '{print $NF}')
  echo "${i},${mrss},${wctime},${systime},${utime},0" >> ${summary}
  done
  
mkdir ${wkdir}/${tagtop}
mv ${wkdir}/${tagtop}*_* ${wkdir}/${tagtop}/.

```


### salmonella

```{bash pickle}
tag=salmonellarz
sketchdir=/home/jbonnie1/scr16_blangme2/jessica/dandd/r_z_d/sketch
stree=${sketchdir}/${tag}_500_dtree.pickle
outcsv=${sketchdir}/${tag}_pu_plot.csv
filelist=/scratch16/blangme2/jessica/data/${tag}_filelist.txt
python lib/dandd_cmd.py progressive -d ${stree} -o ${outcsv} -f ${filelist} -n 1
```

```{r salmonellarz}
salmonellarz=read.csv('/home/jbonnie1/scr16_blangme2/jessica/dandd/r_z_d/sketch/salmonellarz_pu_plot.csv')
salmonellarz <- salmonellarz %>% select(-X) %>% filter(ngenomes %% 2 == 0)

omar100<-read.csv('/home/jbonnie1/scr16_blangme2/jessica/dandd/r_z_d/omar_100.csv') %>% mutate(ngenomes=numgenomes)

deltarz<-full_join(salmonellarz,omar100) %>% filter(ngenomes<=100)

gg_dr <- ggplot(data=omar100) + 
  geom_line(mapping=aes(x=ngenomes,y=r, color="r"), size=1.25) 
gg_dr
```


```{r deltar, echo=FALSE}

deltar = max(deltarz$r)/max(deltarz$delta)
rshift=min(deltarz$d) - min(deltarz$r)/deltar

gg_dr <- ggplot() + 
  geom_line(data=deltarz ,mapping=aes(x=ngenomes,y=delta, color="delta"), size=1.25) +
  geom_line(data=deltarz,mapping=aes(x=ngenomes,y=r/deltar+rshift, color="r"), size=1.25) +
  scale_y_continuous(
    name = "Value of \u03b4*",
    sec.axis = sec_axis(~.*deltar- min(deltarz$r)/deltar, name="Value of r (scaled to \u03b4)")
  ) +
  theme_bw() +
  labs( title="Growth of r and \u03b4 with number of salmonella genomes") +
  xlab("# genomes") +
  #geom_text(aes(x=100,y=2.5e6, color="delta"),label='\u03b4', size=6) +
  #geom_text(aes(x=220,y=3.32e6, color="r"),label='r', size=6) +
  guides(color="none")
  
gg_dr
```


```{r deltaz, echo=FALSE}

deltaz = max(deltarz$z)/max(deltarz$delta)
zshift=min(deltarz$delta) - min(deltarz$z)/deltaz

gg_dz <- ggplot() + 
  geom_line(data=deltarz ,mapping=aes(x=ngenomes,y=delta, color="delta"), size=1.25) +
  geom_line(data=deltarz,mapping=aes(x=ngenomes,y=z/deltaz+zshift, color="z"), size=1.25) +
  scale_y_continuous(
    name = "Value of \u03b4*",
    sec.axis = sec_axis(~.*deltaz- min(deltarz$z)/deltaz, name="Value of z (scaled to \u03b4)")
  ) +
  theme_bw() +
  labs( title="Growth of z and \u03b4* with number of salmonella genomes") +
  xlab("# genomes") +
  #geom_text(aes(x=100,y=2.5e6, color="delta"),label='\u03b4', size=6) +
  #geom_text(aes(x=220,y=3.32e6, color="r"),label='r', size=6) +
  guides(color="none")
  
gg_dz
```


```{r rz, echo=FALSE}

rz = max(deltarz$z)/max(deltarz$r)
#min(deltarz$r)/deltar


#min(deltarz$z)/deltaz
zrshift=min(deltarz$r) - min(deltarz$z)/rz

gg_rz <- ggplot() + 
  geom_line(data=deltarz ,mapping=aes(x=ngenomes,y=r, color="r"), size=1.25) +
  geom_line(data=deltarz,mapping=aes(x=ngenomes,y=z/rz - zrshift, color="z"), size=1.25) +
  scale_y_continuous(
    name = "Value of r*",
    sec.axis = sec_axis(~.*rz+ min(deltarz$z)/rz, name="Value of z")
  ) +
  theme_bw() +
  labs( title="Growth of z and r with number of salmonella genomes") +
  xlab("# genomes") +
  #geom_text(aes(x=100,y=2.5e6, color="delta"),label='\u03b4', size=6) +
  #geom_text(aes(x=220,y=3.32e6, color="r"),label='r', size=6) +
  guides(color="none")
  
gg_rz
```

```{r deltarz, echo=FALSE}

deltar = max(deltarz$r)/max(deltarz$delta)
deltaz = max(deltarz$z)/max(deltarz$delta)

#min(deltarz$r)/deltar
rshift=min(deltarz$delta) - min(deltarz$r)/deltar

#min(deltarz$z)/deltaz
zshift=min(deltarz$delta) - min(deltarz$z)/deltaz

gg_dzr <- ggplot() + 
  geom_line(data=deltarz ,mapping=aes(x=ngenomes,y=delta, color="\u03b4*"), size=1.25) +
  geom_line(data=deltarz,mapping=aes(x=ngenomes,y=z/deltaz+zshift, color="z"), size=1.25) +
  geom_line(data=deltarz,mapping=aes(x=ngenomes,y=r/deltar+rshift, color="r"), size=1.25) +
  scale_y_continuous(
    name = "Value of \u03b4 and r,z scaled to \u03b4*") +
# ,
#     sec.axis = sec_axis(~.*deltar, name="Value of r")
#   ) + 
  # sec.axis = sec_axis(~.*deltaz, name="Value of z") +
  
  theme_bw() +
  labs( title="Growth of r, z, and \u03b4* with number of salmonella genomes") +
  xlab("# genomes") 
#+
  #geom_text(aes(x=100,y=2.5e6, color="delta"),label='\u03b4', size=6) +
  #geom_text(aes(x=220,y=3.32e6, color="r"),label='r', size=6) +
 # guides(color="none")
  
gg_dzr
```